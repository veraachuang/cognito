(()=>{let e=null;function t(e){const t=e.trim().split(/\s+/).length,n=Math.ceil(t/200),o=function(e){const t=e.trim().split(/\s+/),n=e.split(/[.!?]+/).filter((e=>e.trim())),o=function(e){return e.trim().toLowerCase().split(/\s+/).reduce(((e,t)=>(t=t.replace(/[^a-z]/g,"")).length<=3?e+1:e+t.replace(/[^aeiouy]+/g," ").trim().split(/\s+/).length),0)}(e),a=t.length/Math.max(1,n.length),r=o/Math.max(1,t.length);return Math.round(.39*a+11.8*r-15.59)}(e),a=function(e){const t=e.trim().split(/\s+/),n=e.split(/[.!?]+/).filter((e=>e.trim())),o=t.reduce(((e,t)=>e+t.length),0)/t.length,a=t.length/Math.max(1,n.length);return o>5&&a>20?"Academic":o<4&&a<15?"Conversational":"Balanced"}(e);document.getElementById("word-count").textContent=t,document.getElementById("reading-time").textContent=`${n} min`,document.getElementById("grade-level").textContent=o,document.getElementById("writing-style").textContent=a,function(e){const t=e.trim().split(/\s+/).slice(-10),n=new Set(t),o=localStorage.getItem("lastWritingUpdate");return n.size<5||o&&Date.now()-o>3e4}(e)&&function(){const e=document.getElementById("prompts-container");e.innerHTML="",["What is the main point you want to convey?","How does this connect to your previous ideas?","Can you provide an example to illustrate this?","What would someone who disagrees with you say?","How does this relate to your overall topic?"].forEach((t=>{const n=document.createElement("div");n.className="prompt",n.textContent=t,n.onclick=()=>{const e=document.getElementById("braindump-input");e&&(e.value+=`\n\n${t}`,e.focus())},e.appendChild(n)}))}()}console.log("[Cognito] Sidebar script loaded"),window.parent.postMessage({action:"sidebarReady"},"*"),window.addEventListener("message",(t=>{"docId"===t.data?.action&&(e=t.data.value)})),document.addEventListener("DOMContentLoaded",(()=>{const n=document.getElementById("close-sidebar"),o=document.querySelectorAll(".tab-button"),a=document.querySelectorAll(".tab-panel"),r=document.getElementById("braindump-input"),c=document.getElementById("analyzing-spinner");n.addEventListener("click",(()=>{window.parent.postMessage({action:"closeSidebar"},"*")})),o.forEach((e=>{e.addEventListener("click",(()=>{return n=e.dataset.tab,o.forEach((e=>e.classList.toggle("active",e.dataset.tab===n))),a.forEach((e=>e.classList.toggle("active",e.id===n))),void("braindump"===n&&t(r.value));var n}))})),r.addEventListener("input",(e=>{t(e.target.value),localStorage.setItem("lastWritingUpdate",Date.now())}));const i=document.getElementById("analyze-doc-button"),s=document.getElementById("analysis-status"),l=document.getElementById("recommendations-container");i&&i.addEventListener("click",(async()=>{s.textContent="Fetching document text...",l.innerHTML="",c&&(c.style.display="block");try{const t=await async function(){if(!e)throw new Error("No Google-Docs ID â€“ the iframe never received it.");return new Promise(((t,n)=>{chrome.runtime.sendMessage({action:"getDocText",docId:e},(e=>chrome.runtime.lastError?n(chrome.runtime.lastError.message):e?e.error?n(e.error):e.text?void t(e.text):n("Background returned no text."):n("No response from background.")))}))}();s.textContent="Analyzing with OpenAI...",await async function(e){const t=await fetch("https://api.openai.com/v1/chat/completions",{method:"POST",headers:{"Content-Type":"application/json",Authorization:"Bearer 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"},body:JSON.stringify({model:"gpt-4",messages:[{role:"system",content:"You're an expert writing assistant. Respond with a JSON object including the following keys: vocabulary_level, sentence_structure, clarity_score, engagement_score, recommendations."},{role:"user",content:`Analyze the following writing for grade level, clarity, vocabulary, and engagement:\n\n${e}`}]})}),n=await t.json(),o=n.choices?.[0]?.message?.content||"{}";try{const e=JSON.parse(o);document.getElementById("vocabulary-level").textContent=e.vocabulary_level||"-",document.getElementById("sentence-structure").textContent=e.sentence_structure||"-",document.getElementById("clarity-score").textContent=e.clarity_score||"-",document.getElementById("engagement-score").textContent=e.engagement_score||"-",e.recommendations&&(document.getElementById("recommendations-container").innerHTML=`<ul>${e.recommendations.map((e=>`<li>${e}</li>`)).join("")}</ul>`)}catch(e){console.error("Failed to parse OpenAI response as JSON",e),document.getElementById("recommendations-container").innerHTML=`<p>${o.replace(/\n/g,"<br>")}</p>`}return o}(t),s.textContent="Analysis complete."}catch(e){s.textContent="Failed to analyze.",l.innerHTML=`<p class="error">Error: ${e}</p>`}finally{c&&(c.style.display="none")}}))}))})();
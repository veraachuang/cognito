(()=>{"use strict";var e={200:(e,o,t)=>{var n=t(706);function i(e,o){const t=e.replace(/\s+/g," ").trim();if(!t)return console.warn("[Cognito] No text to analyze"),"";console.log("[Cognito] Processing text:",t.slice(0,100));const n=t.split(/\s+/).length,i=Math.ceil(n/200);return o?.contentWindow&&(o.contentWindow.postMessage({source:"cognito-content",action:"liveTextUpdate",data:t,features:{wordCount:n,readingTime:`${i} min`}},"*"),console.log("[Cognito] Sent live text update")),t}console.log("[Cognito] Google Docs API module loaded"),console.log("[Cognito] Text processor module loaded");var r=t(883);console.log("[Cognito] Sidebar UI module loaded");let s=null,l=!1,a=null;function c(){if(s)return console.log("Sidebar already exists"),{sidebarFrame:s,shadowRoot:a,sidebarVisible:l};console.log("Creating sidebar iframe"),a||(a=(0,n.sZ)()),l=!1;const e=document.createElement("style");e.textContent="\n    .cognito-sidebar {\n      position: fixed;\n      top: 0;\n      right: 0;\n      width: 350px;\n      height: 100vh;\n      background: white;\n      box-shadow: -2px 0 8px rgba(0, 0, 0, 0.1);\n      z-index: 2147483647;\n      transition: transform 0.3s ease;\n      user-select: none;\n      -webkit-user-select: none;\n      pointer-events: auto;\n      transform: translateX(350px);  // Start hidden\n    }\n    .cognito-content-shift {\n      transition: margin-right 0.3s ease, width 0.3s ease;\n    }\n  ",a.appendChild(e);const o=document.createElement("div");return o.className="cognito-sidebar",s=document.createElement("iframe"),s.src=chrome.runtime.getURL("sidebar.html"),s.style.cssText="\n    width: 100%;\n    height: 100%;\n    border: none;\n    background: white;\n  ",o.appendChild(s),a.appendChild(o),console.log("Sidebar iframe created and appended"),document.body.classList.add("cognito-content-shift"),{sidebarFrame:s,shadowRoot:a,sidebarVisible:l}}function d(e=null){if(console.log("toggleSidebar called with activeTab:",e),!s){console.log("Creating new sidebar");const e=c();s=e.sidebarFrame,a=e.shadowRoot,l=e.sidebarVisible}l=!l,console.log("Sidebar visible:",l);const o=a.querySelector(".cognito-sidebar");return o&&(o.style.transform=l?"translateX(0)":"translateX(350px)",e&&s.contentWindow&&s.contentWindow.postMessage({action:"switchTab",tab:e},"*")),document.querySelector(".kix-appview-editor")?(0,r.adjustDocsLayout)(l):(0,r.adjustGenericLayout)(l),l}function u(){return{sidebarFrame:s,shadowRoot:a,sidebarVisible:l}}function g(e,o){try{console.log("Inserting outline into page:",e);const t=function(e){if(console.log("Starting outline formatting with outline:",e),!e||"object"!=typeof e)throw console.error("Invalid outline object:",e),new Error("Invalid outline object provided");let o="";return e.sections.forEach(((e,t)=>{o+=`${e.title}\n\n`,Array.isArray(e.key_points)&&e.key_points.length>0&&e.key_points.forEach((e=>{e&&"string"==typeof e&&(o+=`• ${e.trim()}\n`)})),o+="\n"})),o.trim()||(o="Empty Outline\n\n• No content provided\n"),console.log("Formatted outline text:",o),{text:o,html:o}}(o);console.log("Formatted outline text:",t.text);const n=document.createElement("div");n.className="cognito-inserted-outline",Object.assign(n.style,{border:"1px solid #e0e0e0",padding:"10px 15px",margin:"10px 0",backgroundColor:"#f9f9f9",borderRadius:"4px",fontFamily:"Arial, sans-serif",fontSize:"11pt"}),t.text.split("\n").forEach((e=>{if(e.trim()){const o=document.createElement("div");o.textContent=e,o.style.marginBottom="5px",o.style.lineHeight="1.4",n.appendChild(o)}})),e.insertBefore(n,e.firstChild),console.log("Outline application completed successfully."),m(!0)}catch(e){console.error("Error during outline insertion:",e),console.error("Error stack:",e.stack),m(!1,`Error during insertion: ${e.message}`)}}function m(e,o=null){const t=document.querySelector('iframe[src*="sidebar.html"]');t?.contentWindow?t.contentWindow.postMessage({action:"outlineApplied",success:e,...o&&{error:o}},"*"):console.warn("Sidebar frame not found for notification")}function p(e){const{sidebarFrame:o}=u();if(console.log("Received message event:",e.data),console.log("Event source:",e.source),console.log("Sidebar frame:",o?.contentWindow),e.source!==o?.contentWindow)return void console.log("Message source does not match sidebar frame");const{action:t,data:n}=e.data;switch(console.log("Processing action:",t,"with data:",n),t){case"closeSidebar":console.log("Handling closeSidebar action"),d();break;case"uploadFiles":console.log("Handling uploadFiles action"),i=n.files,console.log("[Cognito] Received files:",i);break;case"applyOutline":if(console.log("Handling applyOutline action"),console.log("Raw outline data:",n.outline),!n.outline)return void console.error("No outline data provided");let e="",r=[];"string"==typeof n.outline?e=n.outline:Array.isArray(n.outline)?(e=n.outline[0]||"",r=n.outline.slice(1)||[]):"object"==typeof n.outline&&(e=n.outline.title||"",r=n.outline.points||[]);const s={sections:[{title:e,key_points:Array.isArray(r)?r.map((e=>e.toString().trim())):[]}]};console.log("Parsed outline:",s),async function(e){console.log("Starting applyOutlineToDocument"),console.log("Outline data:",e);try{const o=document.querySelector(".kix-appview-editor");if(!o)throw new Error("Google Docs editor (.kix-appview-editor) not found.");console.log("Found editor:",o);const t=o.querySelector(".kix-page");t?(console.log(".kix-page found immediately."),g(t,e)):(console.log(".kix-page not found immediately. Setting up MutationObserver..."),new MutationObserver(((o,t)=>{for(const n of o)if(n.addedNodes.length>0)for(const o of n.addedNodes)if(o.nodeType===Node.ELEMENT_NODE){const n=o.matches&&o.matches(".kix-page")?o:o.querySelector(".kix-page");if(n)return console.log(".kix-page found by MutationObserver."),t.disconnect(),void g(n,e)}})).observe(document.body,{childList:!0,subtree:!0}),console.log("MutationObserver is waiting for .kix-page..."))}catch(e){console.error("Error applying outline:",e),console.error("Error stack:",e.stack),m(!1,e.message)}}(s);break;case"getCursorPosition":console.log("Handling getCursorPosition action");const l=function(){const e=window.getSelection();if(!e.rangeCount)return null;const o=e.getRangeAt(0).getBoundingClientRect();return{x:o.left,y:o.top,position:e.toString()}}();o.contentWindow.postMessage({action:"cursorPosition",position:l},"*");break;default:console.log("Unknown action received:",t)}var i}console.log("[Cognito] Outline Manager module loaded"),console.log("[Cognito] Message Handler module loaded"),e=t.hmd(e),console.log("[Cognito] Content script initialized");const b={sidebarFrame:null,sidebarVisible:!1,shadowRoot:null,docsObserver:null,genericObserver:null,layoutDebounceTimer:null,canvasPollingInterval:null,lastText:"",accessToken:null,documentId:null};function y(){try{!function(){console.log("[Cognito] Initializing Google API client");try{const e=window.location.href.match(/\/document\/d\/([a-zA-Z0-9-_]+)/),o=e?e[1]:null;return o?(console.log("[Cognito] Document ID:",o),document.dispatchEvent(new CustomEvent("cognito-google-api-ready",{detail:{documentId:o,accessToken:null}})),Promise.resolve()):(console.warn("[Cognito] Could not extract document ID"),document.dispatchEvent(new CustomEvent("cognito-google-api-failed")),Promise.reject(new Error("Could not extract document ID")))}catch(e){return console.error("[Cognito] Error initializing Google API client:",e),document.dispatchEvent(new CustomEvent("cognito-google-api-failed")),Promise.reject(e)}}();const e=c();b.sidebarFrame=e.sidebarFrame,b.shadowRoot=e.shadowRoot,b.sidebarVisible=e.sidebarVisible,b.docsObserver=(0,r.setupDocsObserver)((()=>f())),b.genericObserver=(0,r.setupGenericObserver)((()=>f()),b.sidebarVisible),chrome.runtime.onMessage.addListener(((e,o,t)=>(console.log("Content script received message:",e),"toggleSidebar"===e.action?(console.log("Toggling sidebar with tab:",e.tab),d(e.tab),t({success:!0}),!0):("fetchDocText"===e.action?t({success:!0,text:getVisibleGoogleDocsText()}):t({success:!1,error:"Unknown action"}),!0)))),window.addEventListener("message",p),window.addEventListener("beforeunload",(()=>{window.removeEventListener("message",p)}))}catch(e){console.error("[Cognito] Error during initialization:",e),h()}}function f(){const e=t(883);document.querySelector(".kix-appview-editor")?e.adjustDocsLayout(b.sidebarVisible):e.adjustGenericLayout(b.sidebarVisible)}function h(){console.log("[Cognito] Starting DOM-based polling (fallback)"),clearInterval(b.canvasPollingInterval),b.canvasPollingInterval=setInterval((()=>{const e=function(){const e=document.querySelector(".kix-appview");if(!e)return console.warn("[Cognito] No .kix-appview container found"),"";const o=document.createTreeWalker(e,NodeFilter.SHOW_TEXT,{acceptNode:e=>e.textContent.trim()?NodeFilter.FILTER_ACCEPT:NodeFilter.FILTER_REJECT});let t="";for(;o.nextNode();)t+=o.currentNode.textContent+" ";return t=t.replace(/\s+/g," ").trim(),t||console.warn("[Cognito] Still found no text in doc"),t}();b.lastText=i(e,b.sidebarFrame)}),2e3)}document.addEventListener("cognito-google-api-ready",(e=>{const{documentId:o,accessToken:t}=e.detail;var n;b.documentId=o,b.accessToken=t,o?b.canvasPollingInterval=(n=e=>{b.lastText=i(e,b.sidebarFrame)},console.log("[Cognito] Starting Google API polling"),setInterval((()=>{const e=function(){const e=document.querySelector(".kix-appview-editor");return e?Array.from(e.querySelectorAll(".kix-lineview-text-block")).map((e=>e.textContent)).join(" ").trim():""}();n&&"function"==typeof n&&n(e)}),2e3)):(console.warn("[Cognito] Could not extract document ID, falling back to DOM method"),h())})),document.addEventListener("cognito-google-api-failed",(()=>{console.warn("[Cognito] Google API failed, falling back to DOM method"),h()})),window.addEventListener("beforeunload",(()=>(0,n.tP)(b))),window.addEventListener("load",y),e.exports&&(e.exports={initialize:y,state:b})},706:(e,o,t)=>{function n(e,o){let t=null;return function(...n){clearTimeout(t),t=setTimeout((()=>{t=null,e(...n)}),o)}}function i(e){e.docsObserver&&(e.docsObserver.disconnect(),e.docsObserver=null),e.genericObserver&&(e.genericObserver.disconnect(),e.genericObserver=null),e.shadowRoot&&(e.shadowRoot.host.remove(),e.shadowRoot=null),e.sidebarFrame&&(e.sidebarFrame=null),e.canvasPollingInterval&&(clearInterval(e.canvasPollingInterval),e.canvasPollingInterval=null),e.sidebarVisible=!1}function r(){const e=document.createElement("div");e.id="cognito-container";const o=e.attachShadow({mode:"open"});return document.body.appendChild(e),o}t.d(o,{sZ:()=>r,sg:()=>n,tP:()=>i}),console.log("[Cognito] Utils module loaded")},883:(e,o,t)=>{t.r(o),t.d(o,{adjustDocsLayout:()=>s,adjustGenericLayout:()=>l,setupDocsObserver:()=>i,setupGenericObserver:()=>r});var n=t(706);function i(e){const o=new MutationObserver(((o,t)=>{if(document.querySelector(".kix-appview-editor")){t.disconnect();const o=new MutationObserver((0,n.sg)((()=>{document.querySelector(".kix-appview-editor")&&e()}),100));return o.observe(document.body,{childList:!0,subtree:!0,attributes:!0,attributeFilter:["style","class"]}),o}}));return o.observe(document.body,{childList:!0,subtree:!0}),o}function r(e,o){const t=document.querySelector("main")||document.querySelector("#main")||document.body;t&&(t.style.transition="margin-right 0.3s ease");const i=new MutationObserver((0,n.sg)((()=>{o&&e()}),100));return i.observe(document.body,{childList:!0,subtree:!0,attributes:!0,attributeFilter:["style","class"]}),i}function s(e){const o=e?"350px":"0";[".kix-appview-editor",".docs-toolbar-wrapper",".docs-titlebar-badges",".docs-horizontal-ruler",".docs-menubar",".docs-header",".companion-guest-app-switcher-container"].forEach((t=>{const n=document.querySelector(t);n&&(".companion-guest-app-switcher-container"===t?(n.style.right=o,n.style.transition="right 0.3s ease"):(n.style.marginRight=o,n.style.width=e?`calc(100% - ${o})`:"100%",n.style.transition="all 0.3s ease"))}));const t=document.querySelector(".kix-page");t&&(t.style.marginRight=o,t.style.transition="margin 0.3s ease"),[".companion-app-switcher-container",".companion-guest-app-switcher-container"].forEach((t=>{const n=document.querySelector(t);n&&(e?(n.style.right=o,n.style.width="var(--companion-app-switcher-width)"):(n.style.right="0",n.style.width=""),n.style.transition="right 0.3s ease")}));const n=document.querySelector(".docs-toolbar-wrapper");if(n){n.style.marginRight=o,n.style.width=e?`calc(100% - ${o})`:"100%",n.style.transition="all 0.3s ease";const t=n.querySelector(".docs-toolbar");t&&(t.style.width="100%",t.style.transition="all 0.3s ease")}if(e){document.body.classList.add("docs-size-compact");const e=document.querySelector(".docs-share-button-label");e&&(e.style.display="none");const t=document.querySelector(".docs-menubar");t&&(t.style.padding="0 4px",t.querySelectorAll(".goog-menu-button, .docs-menu-button").forEach((e=>{e.style.padding="0 3px",e.style.minWidth="20px";const o=e.querySelector(".goog-menu-button-caption, .docs-menu-button-label");if(o){const e=o.textContent;e&&e.length>1&&(o.setAttribute("data-full-text",e),o.textContent=e[0])}}))),document.querySelectorAll(".goog-toolbar-button, .docs-toolbar-button").forEach((e=>{e.style.padding="0 4px",e.style.margin="0 1px"}));const n=document.querySelector(".docs-titlebar-buttons");n&&(n.style.gap="4px",n.style.padding="0 8px"),document.querySelectorAll(".companion-collapser-button-container, .companion-guest-collapser-button-container").forEach((e=>{e&&(e.style.right=o,e.style.transition="right 0.3s ease")}))}else{document.body.classList.remove("docs-size-compact");const e=document.querySelector(".docs-share-button-label");e&&(e.style.display="");const o=document.querySelector(".docs-menubar");o&&(o.style.padding="",o.querySelectorAll(".goog-menu-button, .docs-menu-button").forEach((e=>{e.style.padding="",e.style.minWidth="";const o=e.querySelector(".goog-menu-button-caption, .docs-menu-button-label");o&&o.hasAttribute("data-full-text")&&(o.textContent=o.getAttribute("data-full-text"),o.removeAttribute("data-full-text"))}))),document.querySelectorAll(".goog-toolbar-button, .docs-toolbar-button").forEach((e=>{e.style.padding="",e.style.margin=""}));const t=document.querySelector(".docs-titlebar-buttons");t&&(t.style.gap="",t.style.padding=""),document.querySelectorAll(".companion-collapser-button-container, .companion-guest-collapser-button-container").forEach((e=>{e&&(e.style.right="0")}))}l(e)}function l(e){const o=document.querySelector("main")||document.querySelector("#main")||document.body,t=e?"350px":"0";o&&(o.style.marginRight=t,o.style.width=e?`calc(100% - ${t})`:"100%")}console.log("[Cognito] Layout Manager module loaded")}},o={};function t(n){var i=o[n];if(void 0!==i)return i.exports;var r=o[n]={id:n,loaded:!1,exports:{}};return e[n](r,r.exports,t),r.loaded=!0,r.exports}t.d=(e,o)=>{for(var n in o)t.o(o,n)&&!t.o(e,n)&&Object.defineProperty(e,n,{enumerable:!0,get:o[n]})},t.hmd=e=>((e=Object.create(e)).children||(e.children=[]),Object.defineProperty(e,"exports",{enumerable:!0,set:()=>{throw new Error("ES Modules may not assign module.exports or exports.*, Use ESM export syntax, instead: "+e.id)}}),e),t.o=(e,o)=>Object.prototype.hasOwnProperty.call(e,o),t.r=e=>{"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},t(200)})();
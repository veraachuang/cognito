(()=>{"use strict";var e={200:(e,t,o)=>{var n=o(706);console.log("[Cognito] Google Docs API module loaded");let i=null,r=null;async function s(){try{await gapi.client.init({apiKey:"YOUR_API_KEY",clientId:"YOUR_CLIENT_ID",discoveryDocs:["https://docs.googleapis.com/$discovery/rest?version=v1"],scope:"https://www.googleapis.com/auth/documents.readonly"}),gapi.auth2.getAuthInstance().isSignedIn.listen(a),a(gapi.auth2.getAuthInstance().isSignedIn.get())}catch(e){console.error("[Cognito] Error initializing Google API client:",e),document.dispatchEvent(new CustomEvent("cognito-google-api-failed",{detail:e}))}}function a(e){if(e)i=gapi.auth2.getAuthInstance().currentUser.get().getAuthResponse().access_token,console.log("[Cognito] Google API authenticated"),r=function(){const e=window.location.href.match(/\/document\/d\/([a-zA-Z0-9-_]+)/);return e&&e[1]?e[1]:null}(),document.dispatchEvent(new CustomEvent("cognito-google-api-ready",{detail:{documentId:r,accessToken:i}}));else{console.warn("[Cognito] Not signed in to Google API");try{gapi.auth2.getAuthInstance().signIn()}catch(e){console.error("[Cognito] Error signing in:",e),document.dispatchEvent(new CustomEvent("cognito-google-api-failed",{detail:e}))}}}function l(e){return console.log("[Cognito] Starting Google API polling"),setInterval((async()=>{try{const t=await async function(){if(!i||!r)return null;try{const e=(await gapi.client.docs.documents.get({documentId:r})).result;let t="";return e.body&&e.body.content&&e.body.content.forEach((e=>{e.paragraph&&e.paragraph.elements.forEach((e=>{e.textRun&&e.textRun.content&&(t+=e.textRun.content)}))})),t}catch(e){return console.error("[Cognito] Error fetching document content:",e),null}}();if(!t)return void console.warn("[Cognito] No text retrieved from Google API");e(t)}catch(e){console.error("[Cognito] Error in Google API polling:",e)}}),2e3)}function c(e,t){const o=e.replace(/\s+/g," ").trim();if(!o)return console.warn("[Cognito] No text to analyze"),"";console.log("[Cognito] Processing text:",o.slice(0,100));const n=o.split(/\s+/).length,i=Math.ceil(n/200);return t?.contentWindow&&(t.contentWindow.postMessage({source:"cognito-content",action:"liveTextUpdate",data:o,features:{wordCount:n,readingTime:`${i} min`}},"*"),console.log("[Cognito] Sent live text update")),o}console.log("[Cognito] Text processor module loaded");var d=o(883);console.log("[Cognito] Sidebar UI module loaded");let u=null,g=!1,p=null;function m(){if(u)return console.log("Sidebar already exists"),{sidebarFrame:u,shadowRoot:p,sidebarVisible:g};console.log("Creating sidebar iframe"),p||(p=(0,n.sZ)()),g=!1;const e=document.createElement("style");e.textContent="\n    .cognito-sidebar {\n      position: fixed;\n      top: 0;\n      right: 0;\n      width: 350px;\n      height: 100vh;\n      background: white;\n      box-shadow: -2px 0 8px rgba(0, 0, 0, 0.1);\n      z-index: 2147483647;\n      transition: transform 0.3s ease;\n      user-select: none;\n      -webkit-user-select: none;\n      pointer-events: auto;\n      transform: translateX(350px);  // Start hidden\n    }\n    .cognito-content-shift {\n      transition: margin-right 0.3s ease, width 0.3s ease;\n    }\n  ",p.appendChild(e);const t=document.createElement("div");return t.className="cognito-sidebar",u=document.createElement("iframe"),u.src=chrome.runtime.getURL("sidebar.html"),u.style.cssText="\n    width: 100%;\n    height: 100%;\n    border: none;\n    background: white;\n  ",t.appendChild(u),p.appendChild(t),console.log("Sidebar iframe created and appended"),document.body.classList.add("cognito-content-shift"),{sidebarFrame:u,shadowRoot:p,sidebarVisible:g}}function b(e=null){if(console.log("toggleSidebar called with activeTab:",e),!u){console.log("Creating new sidebar");const e=m();u=e.sidebarFrame,p=e.shadowRoot,g=e.sidebarVisible}g=!g,console.log("Sidebar visible:",g);const t=p.querySelector(".cognito-sidebar");return t&&(t.style.transform=g?"translateX(0)":"translateX(350px)",e&&u.contentWindow&&u.contentWindow.postMessage({action:"switchTab",tab:e},"*")),document.querySelector(".kix-appview-editor")?(0,d.adjustDocsLayout)(g):(0,d.adjustGenericLayout)(g),g}function y(){return{sidebarFrame:u,shadowRoot:p,sidebarVisible:g}}function h(e,t){try{console.log("Inserting outline into page:",e);const o=function(e){if(console.log("Starting outline formatting with outline:",e),!e||"object"!=typeof e)throw console.error("Invalid outline object:",e),new Error("Invalid outline object provided");let t="";return e.sections.forEach(((e,o)=>{t+=`${e.title}\n\n`,Array.isArray(e.key_points)&&e.key_points.length>0&&e.key_points.forEach((e=>{e&&"string"==typeof e&&(t+=`• ${e.trim()}\n`)})),t+="\n"})),t.trim()||(t="Empty Outline\n\n• No content provided\n"),console.log("Formatted outline text:",t),{text:t,html:t}}(t);console.log("Formatted outline text:",o.text);const n=document.createElement("div");n.className="cognito-inserted-outline",Object.assign(n.style,{border:"1px solid #e0e0e0",padding:"10px 15px",margin:"10px 0",backgroundColor:"#f9f9f9",borderRadius:"4px",fontFamily:"Arial, sans-serif",fontSize:"11pt"}),o.text.split("\n").forEach((e=>{if(e.trim()){const t=document.createElement("div");t.textContent=e,t.style.marginBottom="5px",t.style.lineHeight="1.4",n.appendChild(t)}})),e.insertBefore(n,e.firstChild),console.log("Outline application completed successfully."),f(!0)}catch(e){console.error("Error during outline insertion:",e),console.error("Error stack:",e.stack),f(!1,`Error during insertion: ${e.message}`)}}function f(e,t=null){const o=document.querySelector('iframe[src*="sidebar.html"]');o?.contentWindow?o.contentWindow.postMessage({action:"outlineApplied",success:e,...t&&{error:t}},"*"):console.warn("Sidebar frame not found for notification")}function v(e){const{sidebarFrame:t}=y();if(console.log("Received message event:",e.data),console.log("Event source:",e.source),console.log("Sidebar frame:",t?.contentWindow),e.source!==t?.contentWindow)return void console.log("Message source does not match sidebar frame");const{action:o,data:n}=e.data;switch(console.log("Processing action:",o,"with data:",n),o){case"closeSidebar":console.log("Handling closeSidebar action"),b();break;case"uploadFiles":console.log("Handling uploadFiles action"),i=n.files,console.log("[Cognito] Received files:",i);break;case"applyOutline":if(console.log("Handling applyOutline action"),console.log("Raw outline data:",n.outline),!n.outline)return void console.error("No outline data provided");let e="",r=[];"string"==typeof n.outline?e=n.outline:Array.isArray(n.outline)?(e=n.outline[0]||"",r=n.outline.slice(1)||[]):"object"==typeof n.outline&&(e=n.outline.title||"",r=n.outline.points||[]);const s={sections:[{title:e,key_points:Array.isArray(r)?r.map((e=>e.toString().trim())):[]}]};console.log("Parsed outline:",s),async function(e){console.log("Starting applyOutlineToDocument"),console.log("Outline data:",e);try{const t=document.querySelector(".kix-appview-editor");if(!t)throw new Error("Google Docs editor (.kix-appview-editor) not found.");console.log("Found editor:",t);const o=t.querySelector(".kix-page");o?(console.log(".kix-page found immediately."),h(o,e)):(console.log(".kix-page not found immediately. Setting up MutationObserver..."),new MutationObserver(((t,o)=>{for(const n of t)if(n.addedNodes.length>0)for(const t of n.addedNodes)if(t.nodeType===Node.ELEMENT_NODE){const n=t.matches&&t.matches(".kix-page")?t:t.querySelector(".kix-page");if(n)return console.log(".kix-page found by MutationObserver."),o.disconnect(),void h(n,e)}})).observe(document.body,{childList:!0,subtree:!0}),console.log("MutationObserver is waiting for .kix-page..."))}catch(e){console.error("Error applying outline:",e),console.error("Error stack:",e.stack),f(!1,e.message)}}(s);break;case"getCursorPosition":console.log("Handling getCursorPosition action");const a=function(){const e=window.getSelection();if(!e.rangeCount)return null;const t=e.getRangeAt(0).getBoundingClientRect();return{x:t.left,y:t.top,position:e.toString()}}();t.contentWindow.postMessage({action:"cursorPosition",position:a},"*");break;default:console.log("Unknown action received:",o)}var i}console.log("[Cognito] Outline Manager module loaded"),console.log("[Cognito] Message Handler module loaded"),e=o.hmd(e),console.log("[Cognito] Content script initialized");const w={sidebarFrame:null,sidebarVisible:!1,shadowRoot:null,docsObserver:null,genericObserver:null,layoutDebounceTimer:null,canvasPollingInterval:null,lastText:"",accessToken:null,documentId:null};function x(){try{!function(){const e=document.createElement("script");e.src="https://apis.google.com/js/api.js",e.onload=()=>{gapi.load("client:auth2",s)},document.body.appendChild(e)}();const e=m();w.sidebarFrame=e.sidebarFrame,w.shadowRoot=e.shadowRoot,w.sidebarVisible=e.sidebarVisible,w.docsObserver=(0,d.setupDocsObserver)((()=>S())),w.genericObserver=(0,d.setupGenericObserver)((()=>S()),w.sidebarVisible),chrome.runtime.onMessage.addListener(((e,t,o)=>(console.log("Content script received message:",e),"toggleSidebar"===e.action?(console.log("Toggling sidebar with tab:",e.tab),b(e.tab),o({success:!0}),!0):("fetchDocText"===e.action?o({success:!0,text:getVisibleGoogleDocsText()}):o({success:!1,error:"Unknown action"}),!0)))),window.addEventListener("message",v),window.addEventListener("beforeunload",(()=>{window.removeEventListener("message",v)}))}catch(e){console.error("[Cognito] Error during initialization:",e),E()}}function S(){const e=o(883);document.querySelector(".kix-appview-editor")?e.adjustDocsLayout(w.sidebarVisible):e.adjustGenericLayout(w.sidebarVisible)}function E(){console.log("[Cognito] Starting DOM-based polling (fallback)"),clearInterval(w.canvasPollingInterval),w.canvasPollingInterval=setInterval((()=>{const e=function(){const e=document.querySelector(".kix-appview");if(!e)return console.warn("[Cognito] No .kix-appview container found"),"";const t=document.createTreeWalker(e,NodeFilter.SHOW_TEXT,{acceptNode:e=>e.textContent.trim()?NodeFilter.FILTER_ACCEPT:NodeFilter.FILTER_REJECT});let o="";for(;t.nextNode();)o+=t.currentNode.textContent+" ";return o=o.replace(/\s+/g," ").trim(),o||console.warn("[Cognito] Still found no text in doc"),o}();w.lastText=c(e,w.sidebarFrame)}),2e3)}document.addEventListener("cognito-google-api-ready",(e=>{const{documentId:t,accessToken:o}=e.detail;w.documentId=t,w.accessToken=o,t?w.canvasPollingInterval=l((e=>{w.lastText=c(e,w.sidebarFrame)})):(console.warn("[Cognito] Could not extract document ID, falling back to DOM method"),E())})),document.addEventListener("cognito-google-api-failed",(()=>{console.warn("[Cognito] Google API failed, falling back to DOM method"),E()})),window.addEventListener("beforeunload",(()=>(0,n.tP)(w))),window.addEventListener("load",x),e.exports&&(e.exports={initialize:x,state:w})},706:(e,t,o)=>{function n(e,t){let o=null;return function(...n){clearTimeout(o),o=setTimeout((()=>{o=null,e(...n)}),t)}}function i(e){e.docsObserver&&(e.docsObserver.disconnect(),e.docsObserver=null),e.genericObserver&&(e.genericObserver.disconnect(),e.genericObserver=null),e.shadowRoot&&(e.shadowRoot.host.remove(),e.shadowRoot=null),e.sidebarFrame&&(e.sidebarFrame=null),e.canvasPollingInterval&&(clearInterval(e.canvasPollingInterval),e.canvasPollingInterval=null),e.sidebarVisible=!1}function r(){const e=document.createElement("div");e.id="cognito-container";const t=e.attachShadow({mode:"open"});return document.body.appendChild(e),t}o.d(t,{sZ:()=>r,sg:()=>n,tP:()=>i}),console.log("[Cognito] Utils module loaded")},883:(e,t,o)=>{o.r(t),o.d(t,{adjustDocsLayout:()=>s,adjustGenericLayout:()=>a,setupDocsObserver:()=>i,setupGenericObserver:()=>r});var n=o(706);function i(e){const t=new MutationObserver(((t,o)=>{if(document.querySelector(".kix-appview-editor")){o.disconnect();const t=new MutationObserver((0,n.sg)((()=>{document.querySelector(".kix-appview-editor")&&e()}),100));return t.observe(document.body,{childList:!0,subtree:!0,attributes:!0,attributeFilter:["style","class"]}),t}}));return t.observe(document.body,{childList:!0,subtree:!0}),t}function r(e,t){const o=document.querySelector("main")||document.querySelector("#main")||document.body;o&&(o.style.transition="margin-right 0.3s ease");const i=new MutationObserver((0,n.sg)((()=>{t&&e()}),100));return i.observe(document.body,{childList:!0,subtree:!0,attributes:!0,attributeFilter:["style","class"]}),i}function s(e){const t=e?"350px":"0";[".kix-appview-editor",".docs-toolbar-wrapper",".docs-titlebar-badges",".docs-horizontal-ruler",".docs-menubar",".docs-header",".companion-guest-app-switcher-container"].forEach((o=>{const n=document.querySelector(o);n&&(".companion-guest-app-switcher-container"===o?(n.style.right=t,n.style.transition="right 0.3s ease"):(n.style.marginRight=t,n.style.width=e?`calc(100% - ${t})`:"100%",n.style.transition="all 0.3s ease"))}));const o=document.querySelector(".kix-page");o&&(o.style.marginRight=t,o.style.transition="margin 0.3s ease"),[".companion-app-switcher-container",".companion-guest-app-switcher-container"].forEach((o=>{const n=document.querySelector(o);n&&(e?(n.style.right=t,n.style.width="var(--companion-app-switcher-width)"):(n.style.right="0",n.style.width=""),n.style.transition="right 0.3s ease")}));const n=document.querySelector(".docs-toolbar-wrapper");if(n){n.style.marginRight=t,n.style.width=e?`calc(100% - ${t})`:"100%",n.style.transition="all 0.3s ease";const o=n.querySelector(".docs-toolbar");o&&(o.style.width="100%",o.style.transition="all 0.3s ease")}if(e){document.body.classList.add("docs-size-compact");const e=document.querySelector(".docs-share-button-label");e&&(e.style.display="none");const o=document.querySelector(".docs-menubar");o&&(o.style.padding="0 4px",o.querySelectorAll(".goog-menu-button, .docs-menu-button").forEach((e=>{e.style.padding="0 3px",e.style.minWidth="20px";const t=e.querySelector(".goog-menu-button-caption, .docs-menu-button-label");if(t){const e=t.textContent;e&&e.length>1&&(t.setAttribute("data-full-text",e),t.textContent=e[0])}}))),document.querySelectorAll(".goog-toolbar-button, .docs-toolbar-button").forEach((e=>{e.style.padding="0 4px",e.style.margin="0 1px"}));const n=document.querySelector(".docs-titlebar-buttons");n&&(n.style.gap="4px",n.style.padding="0 8px"),document.querySelectorAll(".companion-collapser-button-container, .companion-guest-collapser-button-container").forEach((e=>{e&&(e.style.right=t,e.style.transition="right 0.3s ease")}))}else{document.body.classList.remove("docs-size-compact");const e=document.querySelector(".docs-share-button-label");e&&(e.style.display="");const t=document.querySelector(".docs-menubar");t&&(t.style.padding="",t.querySelectorAll(".goog-menu-button, .docs-menu-button").forEach((e=>{e.style.padding="",e.style.minWidth="";const t=e.querySelector(".goog-menu-button-caption, .docs-menu-button-label");t&&t.hasAttribute("data-full-text")&&(t.textContent=t.getAttribute("data-full-text"),t.removeAttribute("data-full-text"))}))),document.querySelectorAll(".goog-toolbar-button, .docs-toolbar-button").forEach((e=>{e.style.padding="",e.style.margin=""}));const o=document.querySelector(".docs-titlebar-buttons");o&&(o.style.gap="",o.style.padding=""),document.querySelectorAll(".companion-collapser-button-container, .companion-guest-collapser-button-container").forEach((e=>{e&&(e.style.right="0")}))}a(e)}function a(e){const t=document.querySelector("main")||document.querySelector("#main")||document.body,o=e?"350px":"0";t&&(t.style.marginRight=o,t.style.width=e?`calc(100% - ${o})`:"100%")}console.log("[Cognito] Layout Manager module loaded")}},t={};function o(n){var i=t[n];if(void 0!==i)return i.exports;var r=t[n]={id:n,loaded:!1,exports:{}};return e[n](r,r.exports,o),r.loaded=!0,r.exports}o.d=(e,t)=>{for(var n in t)o.o(t,n)&&!o.o(e,n)&&Object.defineProperty(e,n,{enumerable:!0,get:t[n]})},o.hmd=e=>((e=Object.create(e)).children||(e.children=[]),Object.defineProperty(e,"exports",{enumerable:!0,set:()=>{throw new Error("ES Modules may not assign module.exports or exports.*, Use ESM export syntax, instead: "+e.id)}}),e),o.o=(e,t)=>Object.prototype.hasOwnProperty.call(e,t),o.r=e=>{"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},o(200)})();
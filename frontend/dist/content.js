(()=>{var e={204:e=>{let t=null,o=!1,n=null,i=null,s=null,r=null;function a(e,t){return function(...o){clearTimeout(r),r=setTimeout((()=>{r=null,e(...o)}),t)}}function c(){const e=o?"350px":"0";[".kix-appview-editor",".docs-toolbar-wrapper",".docs-titlebar-badges",".docs-horizontal-ruler",".docs-menubar",".docs-header",".companion-guest-app-switcher-container"].forEach((t=>{const n=document.querySelector(t);n&&(".companion-guest-app-switcher-container"===t?(n.style.right=e,n.style.transition="right 0.3s ease"):(n.style.marginRight=e,n.style.width=o?`calc(100% - ${e})`:"100%",n.style.transition="all 0.3s ease"))}));const t=document.querySelector(".kix-page");t&&(t.style.marginRight=e,t.style.transition="margin 0.3s ease"),[".companion-app-switcher-container",".companion-guest-app-switcher-container"].forEach((t=>{const n=document.querySelector(t);n&&(o?(n.style.right=e,n.style.width="var(--companion-app-switcher-width)"):(n.style.right="0",n.style.width=""),n.style.transition="right 0.3s ease")}));const n=document.querySelector(".docs-toolbar-wrapper");if(n){n.style.marginRight=e,n.style.width=o?`calc(100% - ${e})`:"100%",n.style.transition="all 0.3s ease";const t=n.querySelector(".docs-toolbar");t&&(t.style.width="100%",t.style.transition="all 0.3s ease")}if(o){document.body.classList.add("docs-size-compact");const t=document.querySelector(".docs-share-button-label");t&&(t.style.display="none");const o=document.querySelector(".docs-menubar");o&&(o.style.padding="0 4px",o.querySelectorAll(".goog-menu-button, .docs-menu-button").forEach((e=>{e.style.padding="0 3px",e.style.minWidth="20px";const t=e.querySelector(".goog-menu-button-caption, .docs-menu-button-label");if(t){const e=t.textContent;e&&e.length>1&&(t.setAttribute("data-full-text",e),t.textContent=e[0])}}))),document.querySelectorAll(".goog-toolbar-button, .docs-toolbar-button").forEach((e=>{e.style.padding="0 4px",e.style.margin="0 1px"}));const n=document.querySelector(".docs-titlebar-buttons");n&&(n.style.gap="4px",n.style.padding="0 8px"),document.querySelectorAll(".companion-collapser-button-container, .companion-guest-collapser-button-container").forEach((t=>{t&&(t.style.right=e,t.style.transition="right 0.3s ease")}))}else{document.body.classList.remove("docs-size-compact");const e=document.querySelector(".docs-share-button-label");e&&(e.style.display="");const t=document.querySelector(".docs-menubar");t&&(t.style.padding="",t.querySelectorAll(".goog-menu-button, .docs-menu-button").forEach((e=>{e.style.padding="",e.style.minWidth="";const t=e.querySelector(".goog-menu-button-caption, .docs-menu-button-label");t&&t.hasAttribute("data-full-text")&&(t.textContent=t.getAttribute("data-full-text"),t.removeAttribute("data-full-text"))}))),document.querySelectorAll(".goog-toolbar-button, .docs-toolbar-button").forEach((e=>{e.style.padding="",e.style.margin=""}));const o=document.querySelector(".docs-titlebar-buttons");o&&(o.style.gap="",o.style.padding=""),document.querySelectorAll(".companion-collapser-button-container, .companion-guest-collapser-button-container").forEach((e=>{e&&(e.style.right="0")}))}l()}function l(){const e=document.querySelector("main")||document.querySelector("#main")||document.body,t=o?"350px":"0";e&&(e.style.marginRight=t,e.style.width=o?`calc(100% - ${t})`:"100%")}function d(e=null){console.log("toggleSidebar called with activeTab:",e),t||(console.log("Creating new sidebar"),function(){if(t)return void console.log("Sidebar already exists");console.log("Creating sidebar iframe"),n||(n=function(){const e=document.createElement("div");return e.id="cognito-container",n=e.attachShadow({mode:"open"}),document.body.appendChild(e),n}()),o=!1;const e=document.createElement("style");e.textContent="\n    .cognito-sidebar {\n      position: fixed;\n      top: 0;\n      right: 0;\n      width: 350px;\n      height: 100vh;\n      background: white;\n      box-shadow: -2px 0 8px rgba(0, 0, 0, 0.1);\n      z-index: 2147483647;\n      transition: transform 0.3s ease;\n      user-select: none;\n      -webkit-user-select: none;\n      pointer-events: auto;\n      transform: translateX(350px);  // Start hidden\n    }\n    .cognito-content-shift {\n      transition: margin-right 0.3s ease, width 0.3s ease;\n    }\n  ",n.appendChild(e);const r=document.createElement("div");r.className="cognito-sidebar",t=document.createElement("iframe"),t.src=chrome.runtime.getURL("sidebar.html"),t.style.cssText="\n    width: 100%;\n    height: 100%;\n    border: none;\n    background: white;\n  ",r.appendChild(t),n.appendChild(r),console.log("Sidebar iframe created and appended"),document.body.classList.add("cognito-content-shift"),i&&i.disconnect(),i=new MutationObserver(((e,t)=>{document.querySelector(".kix-appview-editor")&&(t.disconnect(),i=new MutationObserver(a((()=>{document.querySelector(".kix-appview-editor")&&c()}),100)),i.observe(document.body,{childList:!0,subtree:!0,attributes:!0,attributeFilter:["style","class"]}))})),i.observe(document.body,{childList:!0,subtree:!0}),function(){s&&s.disconnect();const e=document.querySelector("main")||document.querySelector("#main")||document.body;e&&(e.style.transition="margin-right 0.3s ease"),s=new MutationObserver(a((()=>{o&&l()}),100)),s.observe(document.body,{childList:!0,subtree:!0,attributes:!0,attributeFilter:["style","class"]})}()}()),o=!o,console.log("Sidebar visible:",o);const r=n.querySelector(".cognito-sidebar");r&&(r.style.transform=o?"translateX(0)":"translateX(350px)",e&&t.contentWindow&&t.contentWindow.postMessage({action:"switchTab",tab:e},"*")),document.querySelector(".kix-appview-editor")?c():l()}console.log("[Cognito] Content script initialized"),window.addEventListener("beforeunload",(function(){i&&(i.disconnect(),i=null),s&&(s.disconnect(),s=null),n&&(n.host.remove(),n=null),t&&(t=null),o=!1})),chrome.runtime.onMessage.addListener(((e,t,o)=>(console.log("Content script received message:",e),"toggleSidebar"===e.action?(console.log("Toggling sidebar with tab:",e.tab),d(e.tab),o({success:!0}),!0):("fetchDocText"===e.action?o({success:!0,text:g()}):o({success:!1,error:"Unknown action"}),!0)))),window.addEventListener("message",(e=>{if(console.log("Received message event:",e.data),console.log("Event source:",e.source),console.log("Sidebar frame:",t?.contentWindow),e.source!==t?.contentWindow)return void console.log("Message source does not match sidebar frame");const{action:o,data:n}=e.data;switch(console.log("Processing action:",o,"with data:",n),o){case"closeSidebar":console.log("Handling closeSidebar action"),d();break;case"uploadFiles":console.log("Handling uploadFiles action"),i=n.files,console.log("[Cognito] Received files:",i);break;case"applyOutline":if(console.log("Handling applyOutline action"),console.log("Raw outline data:",n.outline),!n.outline)return void console.error("No outline data provided");let e="",s=[];"string"==typeof n.outline?e=n.outline:Array.isArray(n.outline)?(e=n.outline[0]||"",s=n.outline.slice(1)||[]):"object"==typeof n.outline&&(e=n.outline.title||"",s=n.outline.points||[]);const r={sections:[{title:e,key_points:Array.isArray(s)?s.map((e=>e.toString().trim())):[]}]};console.log("Parsed outline:",r),m.applyOutlineToDocument(r);break;case"getCursorPosition":console.log("Handling getCursorPosition action");const a=function(){const e=window.getSelection();if(!e.rangeCount)return null;const t=e.getRangeAt(0).getBoundingClientRect();return{x:t.left,y:t.top,position:e.toString()}}();t.contentWindow.postMessage({action:"cursorPosition",position:a},"*");break;default:console.log("Unknown action received:",o)}var i}));class u{constructor(){this.sidebarFrame=null,this.docIframe=null,this.observer=null,this.isInitialized=!1,this.initialize().catch(console.error)}async initialize(){this.isInitialized||(await this.waitForDocsLoad(),this.injectSidebar(),this.setupDocumentObserver(),this.adjustDocsUI(),this.setupMessageHandlers(),this.isInitialized=!0)}async waitForDocsLoad(){return new Promise((e=>{const t=()=>{this.docIframe=document.querySelector("iframe.docs-editor-container"),this.docIframe?.contentDocument?.body?e():setTimeout(t,100)};t()}))}injectSidebar(){this.sidebarFrame=document.createElement("iframe"),this.sidebarFrame.src=chrome.runtime.getURL("sidebar.html"),this.sidebarFrame.className="cognito-ext-sidebar",Object.assign(this.sidebarFrame.style,{position:"fixed",top:"0",right:"0",width:"300px",height:"100vh",border:"none",backgroundColor:"#ffffff",boxShadow:"-2px 0 5px rgba(0, 0, 0, 0.1)",zIndex:"9999"}),document.body.appendChild(this.sidebarFrame)}adjustDocsUI(){const e=document.querySelector(".docs-editor-container").parentElement;e&&Object.assign(e.style,{marginRight:"300px",width:"calc(100% - 300px)"});const t=document.getElementById("docs-chrome");t&&Object.assign(t.style,{marginRight:"300px",width:"calc(100% - 300px)"})}setupDocumentObserver(){this.observer=new MutationObserver((e=>{this.handleDocumentChanges(e)}));this.docIframe?.contentDocument?.body&&this.observer.observe(this.docIframe.contentDocument.body,{childList:!0,subtree:!0,characterData:!0})}handleDocumentChanges(e){clearTimeout(this.debounceTimer),this.debounceTimer=setTimeout((()=>{const e=this.extractVisibleText();this.notifySidebarOfChanges(e)}),500)}extractVisibleText(){if(!this.docIframe?.contentDocument?.body)return"";const e=document.createTreeWalker(this.docIframe.contentDocument.body,NodeFilter.SHOW_TEXT,null,!1);let t,o="";for(;t=e.nextNode();)this.isNodeVisible(t)&&(o+=t.textContent+" ");return o.trim()}isNodeVisible(e){const t=e.parentElement;if(!t)return!1;const o=window.getComputedStyle(t);return"none"!==o.display&&"hidden"!==o.visibility&&"0"!==o.opacity}notifySidebarOfChanges(e){this.sidebarFrame&&this.sidebarFrame.contentWindow.postMessage({action:"documentChanged",text:e},"*")}setupMessageHandlers(){window.addEventListener("message",(async e=>{if(e.source!==this.sidebarFrame?.contentWindow)return;const{action:t,data:o}=e.data;switch(t){case"getCursorPosition":const t=this.getCursorPosition();e.source.postMessage({action:"cursorPosition",position:t},"*");break;case"applyOutline":await this.applyOutlineToDocument(o.outline);break;case"closeSidebar":this.removeSidebar()}}))}getCursorPosition(){const e=this.docIframe?.contentDocument?.querySelector(".kix-cursor");if(!e)return null;const t=e.getBoundingClientRect();return{x:t.left,y:t.top,height:t.height,selectedText:window.getSelection().toString()}}_insertStyledOutline(e,t){try{console.log("Inserting outline into page:",e);const o=this.formatOutline(t);console.log("Formatted outline text:",o.text);const n=document.createElement("div");n.className="cognito-inserted-outline",Object.assign(n.style,{border:"1px solid #e0e0e0",padding:"10px 15px",margin:"10px 0",backgroundColor:"#f9f9f9",borderRadius:"4px",fontFamily:"Arial, sans-serif",fontSize:"11pt"}),o.text.split("\n").forEach((e=>{if(e.trim()){const t=document.createElement("div");t.textContent=e,t.style.marginBottom="5px",t.style.lineHeight="1.4",n.appendChild(t)}})),e.insertBefore(n,e.firstChild),console.log("Outline application completed successfully."),this.sidebarFrame?.contentWindow&&this.sidebarFrame.contentWindow.postMessage({action:"outlineApplied",success:!0},"*")}catch(e){console.error("Error during outline insertion:",e),console.error("Error stack:",e.stack),this.sidebarFrame?.contentWindow&&this.sidebarFrame.contentWindow.postMessage({action:"outlineApplied",success:!1,error:`Error during insertion: ${e.message}`},"*")}}async applyOutlineToDocument(e){console.log("Starting applyOutlineToDocument"),console.log("Outline data:",e);try{const t=document.querySelector(".kix-appview-editor");if(!t)throw new Error("Google Docs editor (.kix-appview-editor) not found.");console.log("Found editor:",t);const o=t.querySelector(".kix-page");o?(console.log(".kix-page found immediately."),this._insertStyledOutline(o,e)):(console.log(".kix-page not found immediately. Setting up MutationObserver..."),new MutationObserver(((t,o)=>{for(const n of t)if(n.addedNodes.length>0)for(const t of n.addedNodes)if(t.nodeType===Node.ELEMENT_NODE){const n=t.matches&&t.matches(".kix-page")?t:t.querySelector(".kix-page");if(n)return console.log(".kix-page found by MutationObserver."),o.disconnect(),void this._insertStyledOutline(n,e)}})).observe(document.body,{childList:!0,subtree:!0}),console.log("MutationObserver is waiting for .kix-page..."))}catch(e){console.error("Error applying outline:",e),console.error("Error stack:",e.stack),this.sidebarFrame?.contentWindow&&this.sidebarFrame.contentWindow.postMessage({action:"outlineApplied",success:!1,error:e.message},"*")}}formatOutline(e){if(console.log("Starting outline formatting with outline:",e),!e||"object"!=typeof e)throw console.error("Invalid outline object:",e),new Error("Invalid outline object provided");let t="";return e.sections.forEach(((e,o)=>{t+=`${e.title}\n\n`,Array.isArray(e.key_points)&&e.key_points.length>0&&e.key_points.forEach((e=>{e&&"string"==typeof e&&(t+=`• ${e.trim()}\n`)})),t+="\n"})),t.trim()||(t="Empty Outline\n\n• No content provided\n"),console.log("Formatted outline text:",t),{text:t,html:t}}async simulateTyping(e,t){for(let o of t){const t=new InputEvent("textInput",{data:o,bubbles:!0,cancelable:!0});e.dispatchEvent(t),await new Promise((e=>setTimeout(e,10)))}}notifySidebarOfChanges(e){console.log("Notifying sidebar of changes:",e),this.sidebarFrame?.contentWindow?this.sidebarFrame.contentWindow.postMessage(e,"*"):console.error("Sidebar frame or contentWindow not available for notification")}removeSidebar(){this.sidebarFrame&&(this.sidebarFrame.remove(),this.sidebarFrame=null);const e=document.querySelector(".docs-editor-container").parentElement;e&&Object.assign(e.style,{marginRight:"0",width:"100%"});const t=document.getElementById("docs-chrome");t&&Object.assign(t.style,{marginRight:"0",width:"100%"}),this.observer&&this.observer.disconnect()}}const m=new u;function g(){const e=document.querySelector(".kix-appview");if(!e)return console.warn("[Cognito] No .kix-appview container found"),"";const t=document.createTreeWalker(e,NodeFilter.SHOW_TEXT,{acceptNode:e=>e.textContent.trim()?NodeFilter.FILTER_ACCEPT:NodeFilter.FILTER_REJECT});let o="";for(;t.nextNode();)o+=t.currentNode.textContent+" ";return o=o.replace(/\s+/g," ").trim(),o||console.warn("[Cognito] Still found no text in doc"),o}e.exports&&(e.exports=u)}},t={};!function o(n){var i=t[n];if(void 0!==i)return i.exports;var s=t[n]={exports:{}};return e[n](s,s.exports,o),s.exports}(204)})();
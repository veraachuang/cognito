(()=>{let e=null,t=!1;function o(o=null){console.log("Toggling sidebar, activeTab:",o),e||(console.log("No sidebar frame found, creating one"),e?console.log("Sidebar already exists"):(console.log("Creating sidebar iframe"),e=document.createElement("iframe"),e.src=chrome.runtime.getURL("sidebar.html"),e.id="cognito-sidebar",e.style.cssText="\n    position: fixed;\n    top: 0;\n    right: -350px;\n    width: 350px;\n    height: 100vh;\n    border: none;\n    z-index: 9999;\n    transition: right 0.3s ease;\n  ",document.body.appendChild(e),console.log("Sidebar iframe created and appended"))),t=!t,console.log("Setting sidebar visibility:",t),e.style.right=t?"0":"-350px";const n=document.querySelector(".docs-editor-container"),s=document.querySelector(".docs-editor"),i=document.querySelector(".docs-content-wrapper");n&&(n.style.width=t?"calc(100% - 350px)":"100%",n.style.transition="width 0.3s ease"),s&&(s.style.width=t?"calc(100% - 350px)":"100%",s.style.transition="width 0.3s ease"),i&&(i.style.width=t?"calc(100% - 350px)":"100%",i.style.transition="width 0.3s ease"),o&&t&&(console.log("Switching to tab:",o),setTimeout((()=>{e&&e.contentWindow?(e.contentWindow.postMessage({action:"switchTab",tab:o},"*"),console.log("Tab switch message sent")):console.error("Sidebar frame or contentWindow not available")}),300))}console.log("Content script initialized"),chrome.runtime.onMessage.addListener(((e,t,n)=>(console.log("Content script received message:",e),"toggleSidebar"===e.action?(console.log("Handling toggleSidebar action"),o(e.tab),n({success:!0})):(console.log("Unknown action:",e.action),n({success:!1,error:"Unknown action"})),!0))),window.addEventListener("message",(t=>{if(t.source!==e?.contentWindow)return;const{action:n,data:s}=t.data;switch(n){case"closeSidebar":o();break;case"uploadFiles":!async function(t){console.log("Starting file upload");const o=new FormData;t.forEach((e=>o.append("files",e)));try{const t=await fetch("http://localhost:5001/api/upload",{method:"POST",body:o}),n=await t.json();console.log("Upload successful:",n),e.contentWindow.postMessage({action:"uploadComplete",success:!0,data:n},"*")}catch(t){console.error("Upload failed:",t),e.contentWindow.postMessage({action:"uploadComplete",success:!1,error:t.message},"*")}}(s.files);break;case"applyOutline":!function(e,t){const o=document.querySelector('div[contenteditable="true"]');if(!o)return;const n=e.sections.map(((e,t)=>{const o=e.key_points.map(((e,t)=>`  ${t+1}. ${e}`)).join("\n");return`${t+1}. ${e.title}\n${o}`})).join("\n\n"),s=document.createElement("div");if(s.textContent=n,t&&t.node){const e=document.createRange();e.setStart(t.node,t.offset),e.insertNode(s)}else o.insertBefore(s,o.firstChild)}(s.outline,s.cursor_position);break;case"getCursorPosition":const t=function(){const e=window.getSelection();if(!e.rangeCount)return null;const t=e.getRangeAt(0),o=t.getBoundingClientRect();return{x:o.left,y:o.top,node:t.startContainer,offset:t.startOffset}}();e.contentWindow.postMessage({action:"cursorPosition",position:t},"*")}}))})();